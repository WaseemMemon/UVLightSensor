metadata:
  name: dht11sensor
  labels:
    nuclio.io/project-name: 4e941d41-7821-4f47-9b0f-943138bb6569
spec:
  description: "Function the is called when a new message is arrived on the iot/sensors/temperature queue, //the function send back a feedback on the iot/logs queue."
  handler: "main:handler"
  runtime: nodejs
  resources: {}
  image: "nuclio/processor-dht11sensor:latest"
  minReplicas: 1
  maxReplicas: 1
  targetCPU: 75
  triggers:
    myMqttTrigger:
      class: ""
      kind: mqtt
      url: "guest:guest@192.168.43.248:1883"
      attributes:
        subscriptions:
          - qos: 0
            topic: iot/sensor/uvsensor
  version: 1
  build:
    image: ""
    noCache: false
    offline: false
    dependencies: []
    runtimeAttributes:
      repositories: []
    functionSourceCode: dmFyIGFtcXAgPSByZXF1aXJlKCdhbXFwbGliJyk7CnZhciB1cmwgPSByZXF1aXJlKCd1cmwnKTsKdmFyIGh0dHAgPSByZXF1aXJlKCdodHRwJyk7CgpsZXQgZXZlbnRfbmFtZTEgPSAidGVtcF9zbXMiOwpsZXQgZXZlbnRfbmFtZTIgPSAidXYiOwpsZXQgYXBpX2tleSA9ICJqZlpmRmd4LWVLSmdYeGZDUHlTWUJ4SkZxb1I3bnl0Sk56X2w4dkNpdmtpIjsKbGV0IHdhcm5pbmcgPSB0cnVlOwoKCiAgICAgICAgYXN5bmMgZnVuY3Rpb24gbG9nZ2VyKG1zZyl7CiAgICAgICAgICAgIHZhciBxID0gJ2lvdC9zZW5zb3IvdXZzZW5zb3InOwogICAgICAgICAgICBjb25zdCBjb25uZWN0aW9uID0gYXdhaXQgYW1xcC5jb25uZWN0KCdhbXFwOi8vZ3Vlc3Q6Z3Vlc3RAMTkyLjE2OC40My4yNDg6NTY3MicpOwogICAgICAgICAgICBjb25zdCBjaCA9IGF3YWl0IGNvbm5lY3Rpb24uY3JlYXRlQ2hhbm5lbCgpOwogICAgICAgICAgICBhd2FpdCBjaC5hc3NlcnRRdWV1ZShxLCB7ZHVyYWJsZTogZmFsc2V9KTsKICAgICAgICAgICAgY2guc2VuZFRvUXVldWUocSwgQnVmZmVyLmZyb20obXNnKSk7CiAgICAgICAgIH0KCiAgICAgICAgIGxldCBzZW5kSUZUVFQgPSBhc3luYyBmdW5jdGlvbihldmVudCwga2V5LCB2YWx1ZTEsIHZhbHVlMiwgdmFsdWUzKXsKICAgICAgICAgICAgdmFyIHBvc191cmwgPSBgaHR0cHM6Ly9tYWtlci5pZnR0dC5jb20vdHJpZ2dlci91di93aXRoL2tleS9qZlpmRmd4LWVLSmdYeGZDUHlTWUJ4SkZxb1I3bnl0Sk56X2w4dkNpdmtpYDsKICAgICAgICAgICAgbGV0IHBvc3REYXRhID0gSlNPTi5zdHJpbmdpZnkoeyB2YWx1ZTEsIHZhbHVlMiwgdmFsdWUzIH0pOwoKICAgICAgICAgICAgdmFyIHBhcnNlZFVybCA9IHVybC5wYXJzZShwb3NfdXJsKTsKICAgICAgICAgICAgdmFyIHBvc3Rfb3B0aW9ucyA9IHsKICAgICAgICAgICAgICAgIGhvc3RuYW1lOiBwYXJzZWRVcmwuaG9zdG5hbWUsCiAgICAgICAgICAgICAgICBwb3J0OiBwYXJzZWRVcmwucG9ydCwKICAgICAgICAgICAgICAgIHBhdGg6IHBhcnNlZFVybC5wYXRoLAogICAgICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsCiAgICAgICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJywKICAgICAgICAgICAgICAgICAgICAnQ29udGVudC1MZW5ndGgnOiBwb3N0RGF0YS5sZW5ndGgKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfTsgCiAgICAgICAgICAgIHZhciBwb3N0X3JlcSA9IGh0dHAucmVxdWVzdChwb3N0X29wdGlvbnMsIGZ1bmN0aW9uKHJlcykgewogICAgICAgICAgICByZXMuc2V0RW5jb2RpbmcoJ3V0ZjgnKTsKICAgICAgICAgICAgcmVzLm9uKCdkYXRhJywgZnVuY3Rpb24gKGNodW5rKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnUmVzcG9uc2U6ICcgKyBjaHVuayk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0pOwoKICAgICAgICAvLyBUcmlnZ2VyIGEgUE9TVCB0byB0aGUgdXJsIHdpdGggdGhlIGJvZHkuCiAgICAgICAgcG9zdF9yZXEud3JpdGUocG9zdERhdGEpOwogICAgICAgIHBvc3RfcmVxLmVuZCgpOwogICAgfSAgIAoKICAgICAgICBleHBvcnRzLmhhbmRsZXIgPSBmdW5jdGlvbihjb250ZXh0LCBldmVudCkgewogICAgICAgICAgICB2YXIgX2V2ZW50ID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShldmVudCkpOwogICAgICAgICAgICB2YXIgX2RhdGEgPSBTdHJpbmcuZnJvbUNoYXJDb2RlKC4uLl9ldmVudC5ib2R5LmRhdGEpOwoKICAgICAgICAgICAgY29udGV4dC5jYWxsYmFjaygiZmVlZGJhY2sgIitfZGF0YSk7CiAgICAgICAgICAgIGxvZ2dlcigiTGV2ZWwgT2YgVVYgUmF5cyBhcmU6ICIrX2RhdGEpOwogICAgICAgICAgICAvL3ZhciByYXlzICA9IF9kYXRhLnNsaWNlKDAsNik7CiAgICAgICAgICAgIHZhciByYXlzID0gX2RhdGEKICAgICAgICAgICAgaWYoKHJheXM8PTYpKXsKICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHNlbmRJRlRUVChldmVudF9uYW1lMSwgYXBpX2tleSwgInt3YXJuaW5nOnRydWUiLCJVdlJheXNMZXZlbCIrX2RhdGEpOwogICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgfTs=
    commands:
      - 'npm install amqplib'
    codeEntryType: sourceCode
  platform: {}
